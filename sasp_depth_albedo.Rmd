---
title: "SASP Snow Depth and Albedo"
author: "Danielle Reimanis"
date: "1/5/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(tidyverse)
library(tidyr)
library(lubridate)
library(ggthemes)
library(ggpubr)
library(ggplot2)

```

Steven and I talked 1/4/21 about what needs to be done to finish up this semester. I need to do a lot of analysis still, I need results! This code and Rmarkdown file are to be well organized and go into depth on analysis. What patterns can we find? What are the data telling us? 

1) Plotting changes in albedo and changes in snow depth only at SASP. Is there a pattern? Can we look at the timing of the points and notice a hysteresis? 

2) We were in contact with Jeff about unfiltered and filtered data. 

"Hi - unfiltered is broadband, 305-2800, filtered is Near infrared 780-2800.  broadband minus NIR gives you the visible spectrum.  The metadata shows the below: https://snowstudies.org/archived-data/.  Look at a picture of the electromagnetic spectrum to see a visual.  

(i) Broad band CM21 pyranometer: 305-2800 nm 
(ii) NIR to SWIR CM21-RG695 pyranometer: 780-2800 nm
(iii)CG4 pyrgeometer: 4.5-42 Î¼m (50% points)"

**Because of this new information, I will only be using Unfiltered data, as it includes visible**

Objective: Complete 2017-2019 dataset
Problem: In the 2018-2019 graphs, I noticed the albedo was 0.6 and higher even though the snow depth was 0cm. That does not make sense. 
Plan: To incorporate depth from Red Mountain Pass Snotel to the depths that read 0 in the SASP data. 
Justification: Refer to the two year comparison of SASP depth to SNOTEL depth. There are depth values, through the shoulder months of 2018, that were not accounted for in SASP.

Preliminary:
```{r}
load("data/red_mtn_pas.Rdata")

simple_red_mtn_pass <- red_mtn_pass %>%
  select(1,7,8)%>%
  rename("date" = 1,
         "depth_in" = 2,
         "swe_in" = 3)%>%
  mutate(date = as_date(date))%>%
  mutate(swe_mm = swe_in*25.4,
         depth_cm = depth_in*2.54,
         depth_m = depth_cm/100,
         density_kg_m3 = ifelse(depth_m == 0, 0, swe_mm/depth_m))

#Largest SWE in 2017-18 snowpack was 416.56 mm
#Largest SWE in 2018-19 snowpack was 924.56 mm

ggplot(simple_red_mtn_pass, aes(x=date, y=swe_mm))+
  geom_line()+
  theme_bw()+
  labs(title = "SWE for Two Years at Red Mtn Pass SNOTEL")

ggplot(simple_red_mtn_pass, aes(x=date, y=density_kg_m3))+
  geom_line()+
  theme_bw()+
  labs(title = "Density for Two Years at Red Mtn Pass SNOTEL")


```

What is needed to determine if SNOTEL or SASP depth should be used?

SASP and SNOTEL have similar depth trends. SNOTEL has more non-NA and non-zero points than SASP. At first, I mutated SASP depth so all NAs were turned to zeros. This turned out to hinder the results, as there were SASP days that showed an albedo greater than its non-snow equivalent (SCA = 0%). Though albedo rose to 'snow-levels' the depth read 0 cm still. The SNOTEL data showed there was depth on these days, at least at the the SNOTEl site. 

Final Steps: 
If snow depth is 0 but albedo is greater than 0.2, I will replace the depth value (0) with the depth at SNOTEL the same day. It turns out, we just needed to replace all NA values with snotel depth values instead. Also, negative values were replaced with SNOTEL values.

```{r}
load("data/sasp_noon.Rdata")

snotel_depth_cm <- simple_red_mtn_pass$depth_cm
snotel_swe_mm <- simple_red_mtn_pass$swe_mm

sasp_alb_depth_corrected <- sasp_noon%>%
  mutate(snotel_depth_cm = snotel_depth_cm)%>%
  mutate(snotel_swe_mm = snotel_swe_mm)

sasp_alb_depth <- sasp_alb_depth_corrected  %>%
  select(1, 22, 24, 34, 37, 46, 47)%>%
  mutate(alb_unfilt = PyDwn_Unfilt_W/PyUp_Unfilt_W,
         sasp_depth_cm = Sno_Height_M * 100)%>%
  filter(alb_unfilt > 0,
         alb_unfilt < 1)%>%#filtering these values removes 108 observations (730->622)
    filter(date != "2019-03-15",
         date != "2019-03-16",
         date != "2019-03-14",
         date != "2019-03-13")#filtering these values removes 4 observations (622-618)

alb_depth_corrected <- sasp_alb_depth %>%
  select(1, 5:9)%>%
  rename("sasp_precip_mm" =2)%>%
  mutate(delta_albedo = alb_unfilt - lag(alb_unfilt))%>%
  mutate(depth_cm = ifelse(is.na(sasp_depth_cm), snotel_depth_cm, 
                           ifelse(sasp_depth_cm <0, snotel_depth_cm, sasp_depth_cm)))%>%
  mutate(depth_m = depth_cm/100,
         calc_density_kg_m3 = ifelse(depth_m == 0, 0, snotel_swe_mm/depth_m),
         snotel_depth_m = snotel_depth_cm/100,
         snotel_density_kg_m3 = ifelse(snotel_depth_m == 0, 0,
                                       snotel_swe_mm/snotel_depth_m))%>%
  select(1, 4, 5:12)
  
# tail(sort(alb_depth_corrected$calc_density_kg_m3), 10)
# tail(sort(alb_depth_corrected$snotel_density_kg_m3), 10)
# this explains why I chose not to use calculated density (snotel swe/corrected sasp depth) and needed to use snotel density (snotel swe/snotel depth)
```

Notes on alb_depth_corrected
The point of this dataframe was to create a working dataset so if there were any NA's in the SASP depth data, we could use the depth data from SNOTEL. This also made sense since there were albedo values implying snow (>0.6) yet the snow depth at SASP was NA, or zero, but more often NA. Please refer to October 9th-26th of 2018. (Here are other days: 9/24/17,   Using the SNOTEL depth data to replace the NA's algined with some of the albedo readings. However, there were some late spring albedo readings that implied ground, ~0.17, but the snow depth (SNOTEL's depth not SASP's) was >0. Please refer to May 17th-29th of 2018. Albedo decreases, as depth decreases, but so far in the an analysis - any snow readings >0 show an albedo greater than the ground's albedo. So which is correct? 0cm of snow or simply a lower albedo due to a melting snowpack (comparable to ground levels)?

NOTES: 

**2017-2018**

1) Early Snow Events
-Snow starts accumulating at SNOTEL 11/1/2017 (there are sporadic storms in October and late November)
-Snow starts accumulating at SASP 10/1/2017 (there are NAs and negatives before this day). Even though it is 'accumulating' the depth stays low, never reaching 5.3 cm until 11/1/2017. This must have been the 'season starting storm'. FOCUS ON ALBEDO HERE
-During the month of October albedo changes often and dramatically. Increases in snow depth changes the albedo. Quickly the albedo returns to ground level. 

2) Accumulation and Melt
-Albedo steadily grew, depth steadily grew. On 1/24/18, the albedo jumps to over 0.7, there are 74.5 cm of snow depth. It stays above 0.7 and borders 0.8, 0.9 for months. All while the snow is still accumulating. 
-The peak depth at SASP was on 3/23/18 with 126.9 cm. The peak depth at SNOTEL was on 2/20/18 with 119.38 cm. The second highest depth at SASP was on 4/14/18 with 123.8 cm. The second highest depth at SNOTEL was on 4/14/18 with 116.8 cm.
-There are snow events after this max depths. Maximum SWE at SNOTEL is reached on 4/25/18 and thereafter the snow quickly melts away finishing 5/17/18 at SASP and 5/30/18 at SNOTEL.
-Albedo noticeably stops increasing and gradually decreases starting 3/23/18 returning to ground levels 5/17/18. The albedo shows very similar patterns (qualitatively) to the patterns of the snow depth. When depth increases, so does albedo and vice versa. 
-Albedo seems relative to values around it, there are multiple depths with the same albedo, but generally speaking if albedo decreases/increases same with albedo relative to where it was. 

**2018-2019**

1) Early Snow Events
-Snow starts accumulating at SNOTEL on 10/9/18. This is the first recorded snow event of the season. 
-Snow starts accumulating at SASP on 10/27/18, all previous values are NA. 
-Albedo starts increasing on 10/9/18. A jump from ground albedo (0.14) to 0.78. Fifteen cm were recorded at SNOTEL. 

2) Accumulation and Melt
-Albedo stays above 0.64 (dropping twice to values within 0.5-0.6) until the snowpack reaches 63.6 cm where the albedo stays above 0.7 (occasionally dropping to <0.7) until melt starts occuring. 
-Peak depth at SASP occurred on 3/9/19 with 280.7 cm. On 3/25/19 the snow jumps to 277.1 cm where it starts dropping after. The second highest depth at SASP was 3/18/19.
-Snow melts until 6/26/19 when snow depth becomes negative. However, snow accumulates again and reaches 28.3 cm until it completely melts on 7/11/19. I think something is wrong here. It COULD be a summer snow storm placing a few cm down EVERY DAY, but this is unlikely. The albedo returns to ground level (<0.19) on 6/27/19.
-Peak depth at SNOTEL occurred on 3/17/19 with 281.94 cm. The second highest depth was on 3/9/18 with 276.86 cm. On 7/6/19 the snow wass completely melted at SNOTEL. 
-Peak SWE at SNOTEL occurred on 5/2/19 with 924.56 mm. All SWE is gone by 7/6/19. Interestingly, a few days of 5/2/19 have been filtered out (because albedo was >1 or <0, indicating a large storm just came through and topped off the SWE)
-Albedo stays consistently above 0.7 until 4/8/19 where it drops below 0.7 and stays there, gradually decreasing (with a few noticeable spikes), until albedo returns to ground levels on 6/27/19. 
-Similar to above, albedo tends to follow similar relative trends to that of snow depth. Slight decreases in snow depth show slight decreases in albedo. 

Short term: Create dataframe to replace these values (5/17/18-5/29/18) & (6/27/19-7/11/19) with 0 cm snow depth. 

```{r}
alb_depth_corrected_2 <- alb_depth_corrected %>%
  mutate(depth_cm = ifelse(date < "2018-05-30" &
                             date > "2018-05-16", 0 ,depth_cm),
         depth_cm = ifelse(date < "2019-07-12" &
                             date > "2019-06-25", 0, depth_cm))
  
```

1) What is the ground's albedo?
The mean albedo for snow free days was 0.1618064. With values ranging from 0.1115 to 0.1919.

```{r}

#First I filtered the snow depth to only be 0 cm. But since there were high albedo values even with a 0 cm snow depth, I graphed the points and noticed the only spikes that occured (showing errors in the data) were all above 0.2. Next, I filtered albedo to all values less than 0.2. Then I took the average. This is the average albedo for SNOW FREE days.

ground_albedo <- alb_depth_corrected %>%
  filter(depth_cm == 0,
         alb_unfilt <= 0.2)

#mean(ground_albedo$alb_unfilt)
#summary(ground_albedo)
```


2017 - 2018 Winter Season RE: depth and albedo

```{r}
#filtered for snow-on. first day of accumulation was 9/24/17 last day of melt was 5/17/18
#This first day and last day are chosen so the new dataset starts at 0 cm depth, and ends with 0 cm depth.

#grouped albedo by the mean of albedo values (mean = 0.5928825)
#mean depth is 51.06289 cm
#I chose a depth of 70 because that's when I noticed albedo levels peaking

sasp_17_18 <- alb_depth_corrected_2 %>%
  filter(date < "2018-05-18",
         date > "2017-09-22")%>%
  mutate(alb_group = ifelse(alb_unfilt <0.6, "Albedo<0.6", "Albedo>0.6"),
         depth_group = ifelse(depth_cm <= 70, "Depth<70_cm", "Depth>70_cm"),
         date_group = ifelse(date <= "2018-04-14", "Accumulation", "Melt"))%>%
  mutate(delta_snow_depth_cm = depth_cm - lag(depth_cm))
```

Plots for 2017 - 2018 Snow Season RE: depth and albedo

```{r}
ggplot(sasp_17_18, aes(x=delta_snow_depth_cm, y=delta_albedo, 
                       color = date, shape = depth_group))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Change in albedo and snow depth at SASP: 9/23/2017 - 05/17/2018",
       x=expression(Delta*" Snow Depth (cm)"), y=expression(Delta*" Broadband Albedo"))

#Close up of (0,0)
ggplot(sasp_17_18, aes(x=delta_snow_depth_cm, y=delta_albedo, 
                       color = date, shape = depth_group))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Change in albedo and snow depth at SASP: 9/23/2017 - 05/17/2018",
       x=expression(Delta*" Snow Depth (cm)"), y=expression(Delta*" Broadband Albedo"))+
  xlim(min = -5, max = 5)+
  ylim(min = -0.2, max = 0.2)
 
#With regression line
ggplot(sasp_17_18, aes(x=delta_snow_depth_cm, y=delta_albedo, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Change in albedo and snow depth at SASP: 9/23/2017 - 05/17/2018",
       x=expression(Delta*" Snow Depth (cm)"), y=expression(Delta*" Broadband Albedo"))+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.65, label.y.npc = 0.75)
 
#Change in depth to albedo
ggplot(sasp_17_18, aes(x=delta_snow_depth_cm, y=alb_unfilt, 
                       color = date, shape = depth_group))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Albedo vs changes in snow depth at SASP: 9/23/2017 - 05/17/2018",
       x=expression(Delta*" Snow Depth (cm)"), y=expression("Broadband Albedo"))

#Change in depth versus albeo with stat regression line and considering ground albedo
ggplot(sasp_17_18, aes(x=delta_snow_depth_cm, y=alb_unfilt, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Albedo vs snow depth at SASP: 9/23/2017 - 05/17/2018",
       x=expression(Delta*"Snow Depth (cm)"), y=expression(Delta*"Broadband Albedo"))+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.5, label.y.npc = 0.95)

#Filtering out the ground albedo levels
ggplot(sasp_17_18%>%filter(alb_unfilt > 0.2), aes(x=delta_snow_depth_cm, y=alb_unfilt, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Albedo vs snow depth at SASP: 9/23/2017 - 05/17/2018",
       x=expression(Delta*"Snow Depth (cm)"), y=expression(Delta*"Broadband Albedo"))+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.5, label.y.npc = 0.95)

#Normal depth vs albedo
ggplot(sasp_17_18, aes(x=depth_cm, y=alb_unfilt, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Albedo vs snow depth at SASP: 9/23/2017 - 05/17/2018",
       x=expression("Snow Depth (cm)"), y=expression("Broadband Albedo"))

#Depth versus albeo with stat regression line
ggplot(sasp_17_18, aes(x=depth_cm, y=alb_unfilt, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Albedo vs snow depth at SASP: 9/23/2017 - 05/17/2018",
       x=expression("Snow Depth (cm)"), y=expression("Broadband Albedo"))+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.5, label.y.npc = 0.95)

#Filtering out ground albedo values
ggplot(sasp_17_18%>%filter(alb_unfilt > 0.2), aes(x=depth_cm, y=alb_unfilt, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Albedo vs snow depth at SASP: 9/23/2017 - 05/17/2018",
       x=expression("Snow Depth (cm)"), y=expression("Broadband Albedo"))+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.5, label.y.npc = 0.95)

#With a line (to trace dates)
ggplot(sasp_17_18, aes(x=depth_cm, y=alb_unfilt, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  geom_path()+
  theme_bw()+
  labs(title = "Albedo vs snow depth at SASP: 9/23/2017 - 05/17/2018",
       x=expression("Snow Depth (cm)"), y=expression("Broadband Albedo"))

```

2018 - 2019 Winter Season RE: depth and albedo

```{r}
#filtered for snow-on. first day of accumulation was 10/09/18 last day of melt was 6/26/19
#grouped albedo by the mean of albedo values (mean = 0.6938157)
#mean depth is 132.29 cm

sasp_18_19 <- alb_depth_corrected_2 %>%
  filter(date > "2018-10-05",
         date < "2019-06-28")%>%
  mutate(alb_group = ifelse(alb_unfilt <0.6, "Albedo<0.6", "Albedo>0.6"),
         depth_group = ifelse(depth_cm <= 70, "Depth<70_cm", "Depth>70_cm"),
         date_group = ifelse(date <= "2018-03-18", "Accumulation", "Melt"))%>%
  mutate(delta_snow_depth_cm = depth_cm - lag(depth_cm))

```

Plots for 2018 - 2019 Snow Season RE: depth and albedo

```{r}
ggplot(sasp_18_19, aes(x=delta_snow_depth_cm, y=delta_albedo, 
                       color = date, shape = depth_group))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Change in albedo and snow depth at SASP: 10/09/2018 - 06/26/2019",
       x=expression(Delta*" Snow Depth (cm)"), y=expression(Delta*" Broadband Albedo"))

#Close up of (0,0)
ggplot(sasp_18_19, aes(x=delta_snow_depth_cm, y=delta_albedo, 
                       color = date, shape = depth_group))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Change in albedo and snow depth at SASP: 10/09/2018 - 06/26/2019",
       x=expression(Delta*" Snow Depth (cm)"), y=expression(Delta*" Broadband Albedo"))+
  xlim(min = -5, max = 5)+
  ylim(min = -0.2, max = 0.2)

#With regression line
ggplot(sasp_18_19, aes(x=delta_snow_depth_cm, y=delta_albedo, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Change in albedo and snow depth at SASP: 10/09/2018 - 06/26/2019",
       x=expression(Delta*" Snow Depth (cm)"), y=expression(Delta*" Broadband Albedo"))+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.4, label.y.npc = 0.75)

#Change in depth to albedo
ggplot(sasp_18_19, aes(x=delta_snow_depth_cm, y=alb_unfilt, 
                       color = date, shape = depth_group))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Albedo vs changes in snow depth at SASP: 10/09/2018 - 06/26/2019",
       x=expression(Delta*" Snow Depth (cm)"), y=expression("Broadband Albedo"))

#Change in depth versus albeo with stat regression line and considering ground albedo
ggplot(sasp_18_19, aes(x=delta_snow_depth_cm, y=alb_unfilt, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Albedo vs changes in snow depth at SASP: 10/09/2018 - 06/26/2019",
       x=expression(Delta*" Snow Depth (cm)"), y=expression("Broadband Albedo"))+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.4, label.y.npc = 0.65)

#Filtering ground albedo levels
ggplot(sasp_18_19%>%filter(alb_unfilt >0.2), aes(x=delta_snow_depth_cm, y=alb_unfilt, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Albedo vs changes in snow depth at SASP: 10/09/2018 - 06/26/2019",
       x=expression(Delta*" Snow Depth (cm)"), y=expression("Broadband Albedo"))+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.4, label.y.npc = 0.65)

#Normal depth vs albedo
ggplot(sasp_18_19, aes(x=depth_cm, y=alb_unfilt, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Albedo vs snow depth at SASP: 10/09/2018 - 06/26/2019",
       x=expression("Snow Depth (cm)"), y=expression("Broadband Albedo"))

#Depth versus albeo with stat regression line considering ground albedo
ggplot(sasp_18_19, aes(x=depth_cm, y=alb_unfilt, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Albedo vs snow depth at SASP: 10/09/2018 - 06/26/2019",
       x=expression("Snow Depth (cm)"), y=expression("Broadband Albedo"))+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.6, label.y.npc = 0.5)

#Filtering out ground albedo values
ggplot(sasp_18_19%>%filter(alb_unfilt >0.2), aes(x=depth_cm, y=alb_unfilt, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "Albedo vs snow depth at SASP: 10/09/2018 - 06/26/2019",
       x=expression("Snow Depth (cm)"), y=expression("Broadband Albedo"))+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.6, label.y.npc = 0.5)

#With a line (to trace dates)
ggplot(sasp_18_19, aes(x=depth_cm, y=alb_unfilt, 
                       color = date))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  geom_path()+
  theme_bw()+
  labs(title = "Albedo vs snow depth at SASP: 10/09/2018 - 06/26/2019",
       x=expression("Snow Depth (cm)"), y=expression("Broadband Albedo"))

```

2017 - 2019: Two Winter Seasons RE: depth and albedo

```{r}

sasp_17_19 <-sasp_17_18 %>%
  rbind(., sasp_18_19)%>%
  mutate(year = year(date),
         month = month(date),
         month_color = ifelse(month == 1, "Jan",
                        ifelse(month == 2, "Feb",
                         ifelse(month == 3, "Mar",
                          ifelse(month == 4, "Apr",
                           ifelse(month == 5, "May",
                            ifelse(month == 6, "Jun",
                             ifelse(month == 7, "Jul",
                              ifelse(month == 8, "Aug",
                               ifelse(month == 9, "Sep",
                                ifelse(month == 10, "Oct",
                                 ifelse(month == 11, "Nov",
                                  ifelse(month == 12, "Dec", 0)))))))))))))

month_color <- factor(sasp_17_19$month_color, 
                      levels = c("Sep", "Oct", "Nov", "Dec", "Jan",
                                 "Feb", "Mar", "Apr", "May", "Jun",
                                 "Jul", "Aug"), ordered = TRUE)
sasp_17_19$month_color <- month_color

ggplot(sasp_17_19, aes(x=date))+
  geom_bar(aes(y=depth_cm/100), stat = 'identity', fill = "steelblue3")+
  geom_line(aes(y=alb_unfilt), color = "black")+
  scale_y_continuous(name = "Broadband Albedo",
                     sec.axis = sec_axis(~.*100, name = "Snow Depth (cm)"))+
  theme_bw()+
  labs(title = "SASP Albedo and Snow Depth for Two Winter Seasons", x = "date")

```

Plots for Two Winter Seasons RE: depth vs albedo

```{r}
ggplot(sasp_17_19, aes(x=delta_snow_depth_cm, y=delta_albedo, 
                       shape = depth_group, color = month_color))+
  geom_point()+
  theme_bw()+  
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  labs(x=expression(Delta*" Snow Depth (cm)"), y=expression(Delta*"Broadband Albedo"),
       title= "2017 - 2019: Two Winter Seasons at SASP")

#Zoomed in on (0,0)
ggplot(sasp_17_19, aes(x=delta_snow_depth_cm, y=delta_albedo, 
                       shape = depth_group, color = month_color))+
  geom_point()+
  theme_bw()+  
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  labs(x=expression(Delta*" Snow Depth (cm)"), y=expression(Delta*"Broadband Albedo"),
       title= "2017 - 2019: Two Winter Seasons at SASP")+
  xlim(min = -5, max = 5)+
  ylim(min = -0.2, max = 0.2)
 
#With regression line
ggplot(sasp_17_19, aes(x=delta_snow_depth_cm, y=delta_albedo))+
  geom_point()+
  theme_bw()+  
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  labs(x=expression(Delta*" Snow Depth (cm)"), y=expression(Delta*"Broadband Albedo"),
       title= "2017 - 2019: Two Winter Seasons at SASP")+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.65, label.y.npc = 0.75)

 
#Change in depth to albedo
ggplot(sasp_17_19, aes(x=delta_snow_depth_cm, y=alb_unfilt, 
                       shape = depth_group, color = month_color))+
  geom_point()+
  theme_bw()+  
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  labs(x=expression(Delta*" Snow Depth (cm)"), y=expression("Broadband Albedo"),
       title= "2017 - 2019: Two Winter Seasons at SASP")


#Change in depth versus albeo with stat regression line and considering ground albedo
ggplot(sasp_17_19, aes(x=delta_snow_depth_cm, y=alb_unfilt))+
  geom_point()+
  theme_bw()+  
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  labs(x=expression(Delta*" Snow Depth (cm)"), y=expression("Broadband Albedo"),
       title= "2017 - 2019: Two Winter Seasons at SASP")+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.5, label.y.npc = 0.45)

#Filtering out the ground albedo levels
ggplot(sasp_17_19%>%filter(alb_unfilt > 0.2), aes(x=delta_snow_depth_cm, y=alb_unfilt))+
  geom_point()+
  theme_bw()+  
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  labs(x=expression(Delta*" Snow Depth (cm)"), y=expression("Broadband Albedo"),
       title= "2017 - 2019: Two Winter Seasons at SASP")+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.5, label.y.npc = 0.45)

#Normal depth vs albedo
ggplot(sasp_17_19, aes(x=depth_cm, y=alb_unfilt, 
                       color = month_color))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "2017 - 2019: Two Winter Seasons at SASP",
       x=expression("Snow Depth (cm)"), y=expression("Broadband Albedo"))

#Depth versus albeo with stat regression line
ggplot(sasp_17_19, aes(x=depth_cm, y=alb_unfilt))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "2017 - 2019: Two Winter Seasons at SASP",
       x=expression("Snow Depth (cm)"), y=expression("Broadband Albedo"))+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.5, label.y.npc = 0.45)

#Filtering out ground albedo values
ggplot(sasp_17_19%>%filter(alb_unfilt > 0.2), aes(x=depth_cm, y=alb_unfilt))+
  geom_hline(yintercept=0)+
  geom_vline(xintercept=0)+
  geom_point()+
  theme_bw()+
  labs(title = "2017 - 2019: Two Winter Seasons at SASP",
       x=expression("Snow Depth (cm)"), y=expression("Broadband Albedo"))+
  geom_smooth(method = "lm", se = FALSE, color = "black")+
  stat_regline_equation(label.x.npc = 0.5, label.y.npc = 0.45)

```



NEXT STEPS HERE: 
2) Use the lm() function to calculate R squared values
4) Focus on the 'shoulder weeks' of snowpacks and look for albedo patterns with only a few cm of depth. 
3) Similar idea to the depth graphs, use density as the independent variable



